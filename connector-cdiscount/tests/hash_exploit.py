from collections import OrderedDict

import xmltodict as xd
from lxml import etree
import types
from io import StringIO, BytesIO


#convert sample en dict to return for dev
namespaces = {
 'http://schemas.xmlsoap.org/soap/envelope/': None, # skip this namespace
 'http://www.cdiscount.com': None, # collapse "http://a.com/" -> "ns_a"
 'http://www.w3.org/2001/XMLSchema-instance': None, # collapse "http://a.com/" -> "ns_a"
 'http://schemas.datacontract.org/2004/07/Cdiscount.Framework.Core.Communication.Messages': None, # collapse "http://a.com/" -> "ns_a"
 }
#with open('sample.xml','r') as f:
    #my_H = xd.parse(f, process_namespaces=True, namespaces=namespaces)


#my_H = OrderedDict([(u'Envelope', OrderedDict([(u'@xmlns', u'http://schemas.xmlsoap.org/soap/envelope/'), (u'Body', OrderedDict([(u'GetOrderListResponse', OrderedDict([(u'@xmlns', u'http://www.cdiscount.com'), (u'GetOrderListResult', OrderedDict([(u'@xmlni', u'http://www.w3.org/2001/XMLSchema-instance'), (u'ErrorMessage', OrderedDict([(u'@i:nil', u'true'), (u'@xmlns', u'http://schemas.datacontract.org/2004/07/Cdiscount.Framework.Core.Communication.Messages')])), (u'OperationSuccess', OrderedDict([(u'@xmlns', u'http://schemas.datacontract.org/2004/07/Cdiscount.Framework.Core.Communication.Messages'), ('#text', u'true')])), (u'ErrorList', None), (u'SellerLogin', u'login'), (u'TokenId', u'???'), (u'OrderList', OrderedDict([(u'Order', [OrderedDict([(u'ArchiveParcelList', u'false'), (u'BillingAddress', OrderedDict([(u'Address1', OrderedDict([(u'@i:nil', u'true')])), (u'Address2', OrderedDict([(u'@i:nil', u'true')])), (u'ApartmentNumber', None), (u'Building', None), (u'City', u'GUINGAMP'), (u'Civility', u'MISS'), (u'CompanyName', OrderedDict([(u'@i:nil', u'true')])), (u'Country', u'FR'), (u'FirstName', u'ANGELINA'), (u'Instructions', None), (u'LastName', u'BLACKMAN'), (u'PlaceName', None), (u'Street', u'22 AVENUE DES SAULES'), (u'ZipCode', u'22200')])), (u'CreationDate', u'2011-07-26T12:38:31.35'), (u'Customer', OrderedDict([(u'Civility', u'MISS'), (u'CustomerId', u'144a7211e0f420a43c208ec6706b1756'), (u'FirstName', u'ANGELINA'), (u'LastName', u'BLACKMAN'), (u'MobilePhone', u'0612345678'), (u'Phone', None)])), (u'HasClaims', u'false'), (u'InitialTotalAmount', u'3.7'), (u'InitialTotalShippingChargesAmount', u'2.5'), (u'LastUpdatedDate', u'2011-10-21T07:18:14.327'), (u'ModifiedDate', u'2011-07-26T12:39:43.21'), (u'Offer', OrderedDict([(u'@i:nil', u'true')])), (u'OrderLineList', OrderedDict([(u'OrderLine', OrderedDict([(u'AcceptationState', u'ShippedBySeller'), (u'CategoryCode', u'06010701'), (u'DeliveryDateMax', u'2011-07-31T12:38:07.967'), (u'DeliveryDateMin', u'2011-07-28T12:38:07.967'), (u'HasClaim', u'false'), (u'Name', OrderedDict([(u'@i:nil', u'true')])), (u'OrderLineChildList', None), (u'ProductCondition', u'New'), (u'ProductEan', u'0123456789123'), (u'ProductId', u'3725854001106'), (u'PurchasePrice', u'1.2'), (u'Quantity', u'1'), (u'RowId', u'0'), (u'SellerProductId', u'REF3275054001'), (u'ShippingDateMax', u'0001-01-01T00:00:00'), (u'ShippingDateMin', u'0001-01-01T00:00:00'), (u'Sku', u'3725854001106'), (u'SkuParent', OrderedDict([(u'@i:nil', u'true')])), (u'UnitAdditionalShippingCharges', u'0.15'), (u'UnitShippingCharges', u'2.5')]))])), (u'OrderNumber', u'1217261238TV4HA'), (u'OrderState', u'Shipped'), (u'ShippedTotalAmount', u'0'), (u'ShippedTotalShippingCharges', u'0'), (u'ShippingAddress', OrderedDict([(u'Address1', OrderedDict([(u'@i:nil', u'true')])), (u'Address2', OrderedDict([(u'@i:nil', u'true')])), (u'ApartmentNumber', None), (u'Building', None), (u'City', u'GUINGAMP'), (u'Civility', u'MISS'), (u'CompanyName', OrderedDict([(u'@i:nil', u'true')])), (u'Country', u'FR'), (u'County', u'N/A'), (u'FirstName', u'SOPHIE'), (u'Instructions', None), (u'LastName', u'WHITMAN'), (u'PlaceName', None), (u'RelayId', OrderedDict([(u'@i:nil', u'true')])), (u'Street', u'18 AVENUE DES SAULES'), (u'ZipCode', u'22200')])), (u'ShippingCode', u'STD'), (u'SiteCommissionPromisedAmount', u'0'), (u'SiteCommissionShippedAmount', u'0'), (u'SiteCommissionValidatedAmount', u'0'), (u'Status', u'Completed'), (u'ValidatedTotalAmount', u'0'), (u'ValidatedTotalShippingCharges', u'0'), (u'ValidationStatus', u'None'), (u'Corporation', OrderedDict([(u'CorporationId', u'1'), (u'CorporationName', u'Cdiscount'), (u'BusinessUnitId', u'1'), (u'IsMarketPlaceActive', u'true'), (u'CorporationCode', u'CDSB2C')]))]), OrderedDict([(u'ArchiveParcelList', u'false'), (u'BillingAddress', OrderedDict([(u'Address1', OrderedDict([(u'@i:nil', u'true')])), (u'Address2', OrderedDict([(u'@i:nil', u'true')])), (u'ApartmentNumber', None), (u'Building', None), (u'City', u'GUINGAMP'), (u'Civility', u'MISS'), (u'CompanyName', OrderedDict([(u'@i:nil', u'true')])), (u'Country', u'FR'), (u'FirstName', u'SOPHIE'), (u'Instructions', None), (u'LastName', u'WHITMAN'), (u'PlaceName', None), (u'Street', u'18 AVENUE DES SAULES'), (u'ZipCode', u'22200')])), (u'CreationDate', u'2011-07-26T12:38:31.35'), (u'Customer', OrderedDict([(u'Civility', u'MISS'), (u'CustomerId', u'144a7211e0f789a43c208ec6706b1756'), (u'FirstName', u'SOPHIE'), (u'LastName', u'WHITMAN'), (u'MobilePhone', u'0654321987'), (u'Phone', None)])), (u'HasClaims', u'false'), (u'InitialTotalAmount', u'3.7'), (u'InitialTotalShippingChargesAmount', u'2.5'), (u'LastUpdatedDate', u'2011-10-21T07:18:14.327'), (u'ModifiedDate', u'2011-07-26T12:39:43.21'), (u'Offer', OrderedDict([(u'@i:nil', u'true')])), (u'OrderLineList', OrderedDict([(u'OrderLine', [OrderedDict([(u'AcceptationState', u'ShippedBySeller'), (u'CategoryCode', u'06010701'), (u'DeliveryDateMax', u'2011-07-31T12:38:07.967'), (u'DeliveryDateMin', u'2011-07-28T12:38:07.967'), (u'HasClaim', u'false'), (u'Name', OrderedDict([(u'@i:nil', u'true')])), (u'OrderLineChildList', None), (u'ProductCondition', u'New'), (u'ProductEan', u'0123456789123'), (u'ProductId', u'3275054001106'), (u'PurchasePrice', u'1.2'), (u'Quantity', u'1'), (u'RowId', u'0'), (u'SellerProductId', u'REF3275054001'), (u'ShippingDateMax', u'0001-01-01T00:00:00'), (u'ShippingDateMin', u'0001-01-01T00:00:00'), (u'Sku', u'3275054001106'), (u'SkuParent', OrderedDict([(u'@i:nil', u'true')])), (u'UnitAdditionalShippingCharges', u'0.15'), (u'UnitShippingCharges', u'2.5')]), OrderedDict([(u'AcceptationState', u'ShippedBySeller'), (u'CategoryCode', u'06010701'), (u'DeliveryDateMax', u'2011-07-31T12:38:07.967'), (u'DeliveryDateMin', u'2011-07-28T12:38:07.967'), (u'HasClaim', u'false'), (u'Name', OrderedDict([(u'@i:nil', u'true')])), (u'OrderLineChildList', None), (u'ProductCondition', u'New'), (u'ProductEan', u'0123456789123'), (u'ProductId', u'3275054001712'), (u'PurchasePrice', u'2.2'), (u'Quantity', u'2'), (u'RowId', u'0'), (u'SellerProductId', u'REF3275054001'), (u'ShippingDateMax', u'0001-01-01T00:00:00'), (u'ShippingDateMin', u'0001-01-01T00:00:00'), (u'Sku', u'3275054001712'), (u'SkuParent', OrderedDict([(u'@i:nil', u'true')])), (u'UnitAdditionalShippingCharges', u'0.15'), (u'UnitShippingCharges', u'2.5')])])])), (u'OrderNumber', u'1107261238TV3HA'), (u'OrderState', u'Shipped'), (u'ShippedTotalAmount', u'0'), (u'ShippedTotalShippingCharges', u'0'), (u'ShippingAddress', OrderedDict([(u'Address1', OrderedDict([(u'@i:nil', u'true')])), (u'Address2', OrderedDict([(u'@i:nil', u'true')])), (u'ApartmentNumber', None), (u'Building', None), (u'City', u'BORDEAUX'), (u'Civility', u'MISS'), (u'CompanyName', OrderedDict([(u'@i:nil', u'true')])), (u'Country', u'FR'), (u'County', u'N/A'), (u'FirstName', u'VALERIE'), (u'Instructions', None), (u'LastName', u'MUGNIER'), (u'PlaceName', None), (u'RelayId', OrderedDict([(u'@i:nil', u'true')])), (u'Street', u'18 AVENUE D EYSINES'), (u'ZipCode', u'33200')])), (u'ShippingCode', u'STD'), (u'SiteCommissionPromisedAmount', u'0'), (u'SiteCommissionShippedAmount', u'0'), (u'SiteCommissionValidatedAmount', u'0'), (u'Status', u'Completed'), (u'ValidatedTotalAmount', u'0'), (u'ValidatedTotalShippingCharges', u'0'), (u'ValidationStatus', u'None'), (u'Corporation', OrderedDict([(u'CorporationId', u'1'), (u'CorporationName', u'Cdiscount'), (u'BusinessUnitId', u'1'), (u'IsMarketPlaceActive', u'true'), (u'CorporationCode', u'CDSB2C')]))])])]))]))]))]))]))])
#tree = etree.parse("sample.xml")
parser = etree.XMLParser(ns_clean=True)
tree   = etree.parse("sample.xml", parser)
#print tree.getroot()

for order in tree.xpath("Envelope/Body/GetOrderListResponse/GetOrderListResult/OrderList"):
    print (order.OrderNumber)
    print 'toto'
#print my_H

#my_Dict = recursive_dict(tree)

#print my_Dict

# print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']
# OrderList = my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']
#
# print type(OrderList)
# print len(OrderList)
# print "Toto"
# print type(OrderList['Order'])
# print OrderList['Order']
#
# print len(OrderList['Order'] )
#
# print 1
#
#
# print "all data:"
# if type(OrderList['Order'])is types.ListType :
#     print "plusieurs ventes ..."
#     for order in my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']:
#         print order
#         print "kkp"
#         print "billing adress"
#         print order['BillingAddress']
#         print order['BillingAddress']['City']
#         print order['BillingAddress']['Civility']
#         print order['BillingAddress']['Country']
#         print order['BillingAddress']['FirstName']
#         print order['BillingAddress']['LastName']
#         print order['BillingAddress']['Street']
#         print order['BillingAddress']['ZipCode']
#         print order['CreationDate']
#         print order['Customer']
#         print order['HasClaims']
#         print order['InitialTotalAmount']
#         print order['InitialTotalShippingChargesAmount']
#         print order['OrderNumber']
#         print order['OrderState']
#         print order['OrderLineList']
#         print type(order['OrderLineList'])
#         nbreCommande =  len(order['OrderLineList'])
#         print 'Nombre de commande ' +str(nbreCommande)
#         print "orderline List \: "
#         print type (order['OrderLineList']['OrderLine'])
#         if type(order['OrderLineList']['OrderLine']) is types.ListType :
#             print "plus d une ligne de vente"
#             for line in order['OrderLineList']['OrderLine']:
#                 #for k, v in line.iteritems():
#                     print "une ligne de vente : "
#                     print line['CategoryCode']
#                     print line['HasClaim']
#                     print line['Name']
#                     print line['OrderLineChildList']
#                     print line['ProductEan']
#                     print line['ProductId']
#                     print line['PurchasePrice']
#                     print line['Quantity']
#                     print line['RowId']
#                     print line['SellerProductId']
#                     print line['Sku']
#                     print line['SkuParent']
#             print "fin des lignes de ventes "
#
#         else:
#             print "une ligne de vente: "
#             #for k,v in order['OrderLineList']['OrderLine'].iteritems():
#             print order['OrderLineList']['OrderLine']['CategoryCode']
#             print order['OrderLineList']['OrderLine']['HasClaim']
#             print order['OrderLineList']['OrderLine']['Name']
#             print order['OrderLineList']['OrderLine']['OrderLineChildList']
#             print order['OrderLineList']['OrderLine']['ProductEan']
#             print order['OrderLineList']['OrderLine']['ProductId']
#             print order['OrderLineList']['OrderLine']['PurchasePrice']
#             print order['OrderLineList']['OrderLine']['Quantity']
#             print order['OrderLineList']['OrderLine']['RowId']
#             print order['OrderLineList']['OrderLine']['SellerProductId']
#             print order['OrderLineList']['OrderLine']['Sku']
#             print order['OrderLineList']['OrderLine']['SkuParent']
#             print "fin de la ligne de vente"
#         print "shipping addresse: "
#         print order['ShippingAddress']
#         print order['ShippingAddress']['City']
#         print order['ShippingAddress']['Civility']
#         print order['ShippingAddress']['Country']
#         print order['ShippingAddress']['FirstName']
#         print order['ShippingAddress']['LastName']
#         print order['ShippingAddress']['Street']
#         print order['ShippingAddress']['ZipCode']
#         print "fin d'une vente"
#     print "fin des ventes ..."
# else:
#         print " une seule vente .."
#         print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['BillingAddress']['City']
#         print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['BillingAddress']['Civility']
#         print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['BillingAddress']['Country']
#         print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['BillingAddress']['FirstName']
#         print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['BillingAddress']['LastName']
#         print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['BillingAddress']['Street']
#         print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['BillingAddress']['ZipCode']
#         print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['CreationDate']
#         print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['Customer']
#         print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['HasClaims']
#         print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['InitialTotalAmount']
#         print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['InitialTotalShippingChargesAmount']
#         print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['OrderNumber']
#         print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['OrderState']
#         if type(my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['OrderLineList']['OrderLine']) is types.ListType :
#             for line in my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['OrderLineList']['OrderLine']:
#                 print "plus d'une ligne de vente: "+ str(len(my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['OrderLineList']))
#
#                 print line['CategoryCode']
#                 print line['HasClaim']
#                 print line['Name']
#                 print line['OrderLineChildList']
#                 print line['ProductEan']
#                 print line['ProductId']
#                 print line['PurchasePrice']
#                 print line['Quantity']
#                 print line['RowId']
#                 print line['SellerProductId']
#                 print line['Sku']
#                 print line['SkuParent']
#                 print "fin de ligne de vente"
#
#         else:
#             print "une seule ligne de vente"
#             #for k,v in my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['OrderLineList']['OrderLine'].iteritems():
#             print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['OrderLineList']['OrderLine']['CategoryCode']
#             print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['OrderLineList']['OrderLine']['HasClaim']
#             print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['OrderLineList']['OrderLine']['Name']
#             print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['OrderLineList']['OrderLine']['OrderLineChildList']
#             print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['OrderLineList']['OrderLine']['ProductEan']
#             print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['OrderLineList']['OrderLine']['ProductId']
#             print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['OrderLineList']['OrderLine']['PurchasePrice']
#             print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['OrderLineList']['OrderLine']['Quantity']
#             print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['OrderLineList']['OrderLine']['RowId']
#             print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['OrderLineList']['OrderLine']['SellerProductId']
#             print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['OrderLineList']['OrderLine']['Sku']
#             print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['OrderLineList']['OrderLine']['SkuParent']
#             print "shipping addresse: "
#             print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['ShippingAddress']
#             print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['ShippingAddress']['City']
#             print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['ShippingAddress']['Civility']
#             print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['ShippingAddress']['Country']
#             print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['ShippingAddress']['FirstName']
#             print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['ShippingAddress']['LastName']
#             print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['ShippingAddress']['Street']
#             print my_H['Envelope']['Body']['GetOrderListResponse']['GetOrderListResult']['OrderList']['Order']['ShippingAddress']['ZipCode']
#         print "fin de vente"
#
